<!DOCTYPE html>
<html>
<head>
    <title>Strona główna</title>
</head>
<body>

{# Wyświetlanie komunikatów (np. o wysłaniu wniosku) #}
{% if messages %}
    {% for message in messages %}
        <div style="padding: 10px; margin-bottom: 10px; border: 1px solid; 
                    color: {% if message.tags == 'error' %}red{% else %}green{% endif %};">
            {{ message }}
        </div>
    {% endfor %}
{% endif %}

<h1>Witaj w wypożyczalni!</h1>

{% if user.is_authenticated %}
    <p>Jesteś zalogowany jako: <strong>{{ user.username }}</strong></p>

    <nav>
        {# 5. Admin widzi obie zakładki #}
        {% if user.is_superuser %}
            <a href="{% url 'moje_auta' %}">Zarządzaj autami (Admin)</a> | 
            <a href="{% url 'moje_wynajmy' %}">Wszystkie wynajmy</a>
        
        {# 4. Właściciel widzi TYLKO moje auta #}
        {% elif is_wlasciciel %}
            <a href="{% url 'moje_auta' %}">Moje auta</a>
        
        {# Zwykły użytkownik widzi TYLKO moje wynajmy i wniosek #}
        {% else %}
            <a href="{% url 'moje_wynajmy' %}">Moje wynajmy</a>
            <p>
                <a href="{% url 'wniosek_o_wlasciciela' %}" style="color: blue;">
                    Chcę zostać właścicielem
                </a>
            </p>
        {% endif %}
        
        <br><br>
        <a href="{% url 'logout' %}">Wyloguj</a>
    </nav>

{% else %}
    <a href="{% url 'logowanie' %}">Zaloguj się</a>
    <a href="{% url 'rejestracja' %}">Zarejestruj się</a>
{% endif %}

<hr>

<h2>Dostępne samochody</h2>

{% for auto in samochody %}
<div>
    <h3>{{ auto.marka }} {{ auto.model }}</h3>
    <p>Kategoria: {{ auto.kategoria.nazwa }}</p>
    <p>Kolor: {{ auto.kolor }}</p>
    <p>Cena/dobę: {{ auto.cena_za_dobe }} zł</p>

    {% if auto.id in zajete_auta_ids %}
        <p style="color:red;">Niedostępne (Obecnie wynajęte)</p>
        <button disabled>Wynajmij</button>
    {% else %}
        {% if user.is_authenticated %}
            {# Właściciel nie może wynajmować aut (zgodnie z Twoim założeniem) #}
            {% if not is_wlasciciel and not user.is_superuser %}
                {% if user.userprofil.posiada_prawo_jazdy %}
                    <a href="{% url 'wynajem_szczegoly' auto.pk %}">Wynajmij</a>
                {% else %}
                    <p style="color: orange;">Musisz mieć prawo jazdy, aby wynająć.</p>
                    <button disabled>Wynajmij</button>
                {% endif %}
            {% elif user.is_superuser %}
                <span style="color: gray;">(Podgląd admina)</span>
            {% endif %}
        {% else %}
            <a href="{% url 'logowanie' %}">Zaloguj się, aby wynająć</a>
        {% endif %}
    {% endif %}
</div>
<hr>
{% empty %}
<p>Brak samochodów w ofercie.</p>
{% endfor %}

</body>
</html>